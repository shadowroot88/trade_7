services:
  - type: web
    name: freqtrade
    env: python
    plan: free
    buildCommand: |
      apt-get update
      apt-get install -y python3-pip python3-venv build-essential libta-lib0 libta-lib0-dev ta-lib git
      
      # Instalacja TA-Lib z źródeł bezpośrednio ze skonfigurowanymi ścieżkami
      cd /tmp
      wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz
      tar -xzf ta-lib-0.4.0-src.tar.gz
      cd ta-lib/
      ./configure --prefix=/usr
      make
      make install
      
      # Tworzenie linków symbolicznych dla nagłówków i bibliotek
      find /usr -name "libta_lib*"
      
      # Tworzenie linków, żeby Python wrapper mógł znaleźć bibliotekę
      ln -sf /usr/lib/libta_lib.so /usr/lib/libta-lib.so
      ln -sf /usr/lib/libta_lib.a /usr/lib/libta-lib.a
      
      # Tworzenie linków dla plików nagłówkowych
      mkdir -p /usr/include/ta-lib
      ln -sf /usr/include/ta_abstract.h /usr/include/ta-lib/
      ln -sf /usr/include/ta_common.h /usr/include/ta-lib/
      ln -sf /usr/include/ta_func.h /usr/include/ta-lib/
      ln -sf /usr/include/ta_defs.h /usr/include/ta-lib/
      
      # Ustawienie zmiennych środowiskowych do budowania
      export TA_INCLUDE_PATH=/usr/include
      export TA_LIBRARY_PATH=/usr/lib
      
      # Instalacja FreqTrade i zależności
      python -m pip install --upgrade pip
      python -m pip install numpy
      python -m pip install --global-option=build_ext --global-option="-I/usr/include/" --global-option="-L/usr/lib/" ta-lib
      python -m pip install freqtrade
      bash create.sh
    startCommand: bash start.sh
    envVars:
      - key: PYTHONUNBUFFERED
        value: "1"
      - key: FREQTRADE__EXCHANGE__KEY
        value: your_key
      - key: FREQTRADE__EXCHANGE__SECRET
        value: your_secret
      - key: FREQTRADE__API_SERVER__ENABLED
        value: "true"
      - key: FREQTRADE__API_SERVER__USERNAME
        value: "admin"
      - key: FREQTRADE__API_SERVER__PASSWORD
        value: "admin"
      - key: FREQTRADE__API_SERVER__LISTEN_IP_ADDRESS
        value: "0.0.0.0"
      - key: FREQTRADE__API_SERVER__PORT
        value: "8080"
      - key: PORT
        value: "8080"
      - key: FREQTRADE__API_SERVER__VERBOSITY
        value: "info"
    systemDependencies:
      - build-essential  # Dla gcc, make itp.
      - libatlas-base-dev  # Często wymagane przez TA-Lib
      - libffi-dev  # Dla niektórych zależności Pythona
      - curl  # Dla pobierania danych
      - wget  # Dla pobierania plików